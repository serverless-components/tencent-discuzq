(window.webpackJsonp=window.webpackJsonp||[]).push([[53],{"5gzI":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=r(s("QbLZ"));s("lpfh");var i=r(s("9y75"));function r(t){return t&&t.__esModule?t:{default:t}}e.default=(0,a.default)({name:"site-sort-set-view"},i.default)},"9y75":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=o(s("m1cH")),i=o(s("4gYi")),r=o(s("pNQN"));function o(t){return t&&t.__esModule?t:{default:t}}e.default={components:{Card:i.default,CardRow:r.default},data:function(){return{categoriesList:[],groupsList:[],sortData:{usersList:[],topicsList:[],blockUsersList:[],blockTopicsList:[]},threads:"",blockThreads:"",isShow:!0,type:"",searchText:"",timeout:null,state:"",selectedData:[],recommendData:[],siteOpenSort:!1}},created:function(){this.loadSortStatus()},methods:{loadSortStatus:function(){this.getCategories(),this.getGroups(),this.getSortData(),this.getSortBtnStatus()},getCategories:function(){var t=this;this.appFetch({url:"categories",method:"get",data:{}}).then((function(e){e.errors?t.$message.error(e.errors[0].code):e.data.forEach((function(e){var s=[],a=[],i=[];e.attributes.children.forEach((function(t){a.push(t.id),t.checked&&s.push(t.id),i.push({id:t.id,name:t.name})}));var r=s.length===a.length;e.attributes.checked&&r&&(s=[e.id]),t.categoriesList.push({id:e.id,name:e.attributes.name,checked:1===e.attributes.checked,childrens:i,checkedList:s,allList:a,checkAll:r})}))})).catch((function(t){}))},getGroups:function(){var t=this;this.appFetch({url:"groups",method:"get"}).then((function(e){e.errors?t.$message.error(e.errors[0].code):e.data.forEach((function(e){t.groupsList.push({id:e.id,name:e.attributes.name,checked:1===e.attributes.checked})}))})).catch((function(t){}))},getSortData:function(){var t=this;this.appFetch({url:"sequence",methods:"get"}).then((function(e){var s=e.data.attributes;s.users.forEach((function(e){t.sortData.usersList.push({id:e.id,name:e.username})})),s.topics.forEach((function(e){t.sortData.topicsList.push({id:e.id,name:e.content})})),t.threads=s.threads,s.block_users.forEach((function(e){t.sortData.blockUsersList.push({id:e.id,name:e.username})})),s.block_topics.forEach((function(e){t.sortData.blockTopicsList.push({id:e.id,name:e.content})})),t.blockThreads=s.block_threads}))},getSortBtnStatus:function(){var t=this;this.appFetch({url:"forum",method:"get",data:{}}).then((function(e){e.errors?t.$message.error(e.errors[0].code):t.siteOpenSort=1===e.readdata._data.set_site.site_open_sort})).catch((function(t){}))},getRecommendUsers:function(){var t=this,e=[];return this.appFetch({url:"randomUsers",method:"get"}).then((function(s){s.errors?t.$message.error(s.errors[0].code):s.data.forEach((function(t){e.push({id:t.id,name:t.attributes.username})}))})).catch((function(t){})),e},getRecommendTopics:function(){var t=this,e=[];return this.appFetch({url:"randomTopics",method:"get"}).then((function(s){s.errors?t.$message.error(s.errors[0].code):s.data.forEach((function(t){e.push({id:t.id,name:t.attributes.content})}))})).catch((function(t){})),e},querySearchAsync:function(t,e){var s,a=this;t&&(s="用户"===this.searchText?this.searchByUser(t):this.searchByTopic(t),clearTimeout(this.timeout),this.timeout=setTimeout((function(){e(s),a.timeout=null}),1e3))},searchByUser:function(t){var e=[];return this.appFetch({methods:"get",url:"users",params:{"filter[username]":"*"+t+"*"}}).then((function(t){t.data.forEach((function(t){e.push({id:t.attributes.id,value:t.attributes.username,name:t.attributes.username})}))})),e},searchByTopic:function(t){var e=[];return this.appFetch({methods:"get",url:"topics",params:{"filter[content]":t}}).then((function(t){t.data.forEach((function(t){e.push({id:t.attributes.id,value:t.attributes.content,name:t.attributes.content})}))})),e},handleCheckChange:function(t){this.categoriesList[t].checked||(this.categoriesList[t].checkedList=[],this.categoriesList[t].checkAll=!1)},handleChange:function(t){var e=this.categoriesList[t];e.checkedList.includes(e.id)?(this.categoriesList[t].checkedList=[e.id],this.categoriesList[t].checkAll=!0):this.categoriesList[t].checkAll=!1},isShowSelectOptions:function(t){if(t)for(var e in this.$refs)this.$refs[e].blur()},toSearch:function(t,e){this.isShow=!1,this.searchText=e,this.type=t,this.selectedData=this.sortData[this.type],this.recommendData="用户"===e?this.getRecommendUsers():this.getRecommendTopics()},handleSelect:function(t){var e=this.selectedData.some((function(e){return e.id===t.id}));this.state="",e?this.$message.warning("该"+this.searchText+"已被添加"):this.selectedData.push({id:t.id,name:t.name})},handleClose:function(t){this.selectedData.splice(this.selectedData.indexOf(t),1)},selectRecommend:function(t){this.selectedData.some((function(e){return e.id===t.id}))?this.$message.warning("该"+this.searchText+"已被添加"):this.selectedData.push(t)},backSortPage:function(){this.isShow=!0,this.sortData[this.type]=this.selectedData,this.type="",this.searchText="",this.selectedData=[],this.timeout=null},checkFormat:function(t){return!t||/^(\d+,?)*\d+$/.test(t)},getIdString:function(t){var e=[];return t.forEach((function(t){e.push(t.id)})),e.toString()},handleSortSubmit:function(){var t=this;if(this.checkFormat(this.threads)&&this.checkFormat(this.blockThreads)){var e=[],s=[];this.categoriesList.forEach((function(t){t.checked&&(e.push(t.id),t.checkAll?e.push.apply(e,(0,a.default)(t.allList)):e.push.apply(e,(0,a.default)(t.checkedList)))})),this.groupsList.forEach((function(t){t.checked&&s.push(t.id)}));var i={category_ids:e.toString()||"",group_ids:s.toString()||"",user_ids:this.getIdString(this.sortData.usersList)||"",topic_ids:this.getIdString(this.sortData.topicsList)||"",thread_ids:this.threads,block_user_ids:this.getIdString(this.sortData.blockUsersList)||"",block_topic_ids:this.getIdString(this.sortData.blockTopicsList)||"",block_thread_ids:this.blockThreads,site_open_sort:this.siteOpenSort?1:0};this.appFetch({url:"sequence",method:"post",data:{data:{attributes:i}}}).then((function(e){e.errors?e.errors[0].detail?t.$message.error(e.errors[0].code+"\n"+e.errors[0].detail[0]):t.$message.error(e.errors[0].code):t.$message({message:"提交成功",type:"success"})}))}else this.$message.error("主题id格式：以英文逗号分隔，数字结尾，且中间不能有空格")}}}},Fv4X:function(t,e,s){"use strict";s.r(e);var a=s("5gzI"),i=s.n(a);for(var r in a)["default"].indexOf(r)<0&&function(t){s.d(e,t,(function(){return a[t]}))}(r);e.default=i.a},PCZf:function(t,e,s){"use strict";s.d(e,"a",(function(){return a})),s.d(e,"b",(function(){return i}));var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"site-sort-set-box"},[s("div",{directives:[{name:"show",rawName:"v-show",value:t.isShow,expression:"isShow"}]},[s("p",{staticClass:"sort-desc"},[t._v("默认首页：")]),t._v(" "),s("div",{staticClass:"sort-switch-box"},[s("div",{staticClass:"sort-switch"},[s("el-switch",{attrs:{"active-color":"#336699","inactive-color":"#bbbbbb"},model:{value:t.siteOpenSort,callback:function(e){t.siteOpenSort=e},expression:"siteOpenSort"}})],1),t._v(" "),t._m(0)]),t._v(" "),s("div",{directives:[{name:"show",rawName:"v-show",value:t.siteOpenSort,expression:"siteOpenSort"}]},[s("p",{staticClass:"sort-desc"},[t._v("添加内容，在首页显示：")]),t._v(" "),s("el-card",{staticClass:"box-card",attrs:{shadow:"never"}},[s("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[s("span",[t._v("按分类添加：")])]),t._v(" "),t._l(t.categoriesList,(function(e,a){return s("div",{key:e.id,staticClass:"sort-class-item"},[s("el-checkbox",{on:{change:function(e){return t.handleCheckChange(a)}},model:{value:e.checked,callback:function(s){t.$set(e,"checked",s)},expression:"item.checked"}},[t._v(t._s(e.name))]),t._v(" "),s("el-select",{attrs:{multiple:"","collapse-tags":"",placeholder:"请选择",disabled:!e.checked},on:{change:function(e){return t.handleChange(a)}},model:{value:e.checkedList,callback:function(s){t.$set(e,"checkedList",s)},expression:"item.checkedList"}},[s("el-option",{attrs:{label:"全部",value:e.id}}),t._v(" "),t._l(e.childrens,(function(t){return s("el-option",{key:t.id,attrs:{label:t.name,value:t.id,disabled:e.checkAll}})}))],2)],1)}))],2),t._v(" "),s("Card",{attrs:{header:"按用户角色添加："}}),t._v(" "),t._l(t.groupsList,(function(e){return s("div",{key:e.id},[s("Card",[s("CardRow",[s("el-checkbox",{model:{value:e.checked,callback:function(s){t.$set(e,"checked",s)},expression:"item.checked"}},[t._v(t._s(e.name))])],1)],1)],1)})),t._v(" "),s("Card",{staticClass:"sort-border-bottom"},[s("CardRow",[s("div",{staticClass:"sort-item-wrap"},[s("span",[t._v("按用户添加：")]),t._v(" "),s("el-select",{ref:"addUser",attrs:{multiple:"","collapse-tags":""},on:{"visible-change":t.isShowSelectOptions},model:{value:t.sortData.usersList,callback:function(e){t.$set(t.sortData,"usersList",e)},expression:"sortData.usersList"}},t._l(t.sortData.usersList,(function(t){return s("el-option",{key:t.id,attrs:{label:t.name,value:t}})})),1)],1),t._v(" "),s("span",{staticClass:"sort-select-btn",on:{click:function(e){return t.toSearch("usersList","用户")}}},[t._v("选择用户")])])],1),t._v(" "),s("Card",{staticClass:"sort-border-bottom"},[s("CardRow",[s("div",{staticClass:"sort-item-wrap"},[s("span",[t._v("按话题添加：")]),t._v(" "),s("el-select",{ref:"addTopic",attrs:{multiple:"","collapse-tags":""},on:{"visible-change":t.isShowSelectOptions},model:{value:t.sortData.topicsList,callback:function(e){t.$set(t.sortData,"topicsList",e)},expression:"sortData.topicsList"}},t._l(t.sortData.topicsList,(function(t){return s("el-option",{key:t.id,attrs:{label:t.name,value:t}})})),1)],1),t._v(" "),s("span",{staticClass:"sort-select-btn",on:{click:function(e){return t.toSearch("topicsList","话题")}}},[t._v("选择话题")])])],1),t._v(" "),s("Card",{staticClass:"sort-border-bottom"},[s("CardRow",{attrs:{description:"id如有多个请用,隔开，例如：12,54,35帖子id在具体的帖子中的地址后缀展示"}},[s("div",{staticClass:"sort-item-wrap"},[s("span",[t._v("按主题添加：")]),t._v(" "),s("el-input",{model:{value:t.threads,callback:function(e){t.threads=e},expression:"threads"}})],1)])],1),t._v(" "),s("p",{staticClass:"sort-desc"},[t._v("排除内容，不在首页显示：")]),t._v(" "),s("Card",{staticClass:"sort-border-bottom"},[s("CardRow",[s("div",{staticClass:"sort-item-wrap"},[s("span",[t._v("按用户角色排除：")]),t._v(" "),s("el-select",{ref:"excludeUser",attrs:{multiple:"","collapse-tags":""},on:{"visible-change":t.isShowSelectOptions},model:{value:t.sortData.blockUsersList,callback:function(e){t.$set(t.sortData,"blockUsersList",e)},expression:"sortData.blockUsersList"}},t._l(t.sortData.blockUsersList,(function(t){return s("el-option",{key:t.id,attrs:{label:t.name,value:t}})})),1)],1),t._v(" "),s("span",{staticClass:"sort-select-btn",on:{click:function(e){return t.toSearch("blockUsersList","用户")}}},[t._v("选择用户")])])],1),t._v(" "),s("Card",{staticClass:"sort-border-bottom"},[s("CardRow",[s("div",{staticClass:"sort-item-wrap"},[s("span",[t._v("按话题排除：")]),t._v(" "),s("el-select",{ref:"excludeTopic",attrs:{multiple:"","collapse-tags":""},on:{"visible-change":t.isShowSelectOptions},model:{value:t.sortData.blockTopicsList,callback:function(e){t.$set(t.sortData,"blockTopicsList",e)},expression:"sortData.blockTopicsList"}},t._l(t.sortData.blockTopicsList,(function(t){return s("el-option",{key:t.id,attrs:{label:t.name,value:t}})})),1)],1),t._v(" "),s("span",{staticClass:"sort-select-btn",on:{click:function(e){return t.toSearch("blockTopicsList","话题")}}},[t._v("选择话题")])])],1),t._v(" "),s("Card",{staticClass:"sort-border-bottom"},[s("CardRow",{attrs:{description:"id如有多个请用,隔开，例如：12,54,35帖子id在具体的帖子中的地址后缀展示"}},[s("div",{staticClass:"sort-item-wrap"},[s("span",[t._v("按主题排除：")]),t._v(" "),s("el-input",{model:{value:t.blockThreads,callback:function(e){t.blockThreads=e},expression:"blockThreads"}})],1)])],1)],2),t._v(" "),s("el-button",{attrs:{type:"primary",size:"medium"},on:{click:t.handleSortSubmit}},[t._v("提交")])],1),t._v(" "),s("div",{directives:[{name:"show",rawName:"v-show",value:!t.isShow,expression:"!isShow"}],staticClass:"select-box"},[s("p",{staticClass:"sort-desc"},[t._v("选择"+t._s(t.searchText))]),t._v(" "),s("div",{staticClass:"selected-user"},t._l(t.selectedData,(function(e){return s("el-tag",{key:e.id,attrs:{closable:"",type:"info"},on:{close:function(s){return t.handleClose(e)}}},[t._v(t._s(e.name))])})),1),t._v(" "),s("p",{staticClass:"sort-desc"},[t._v("请输入"+t._s("用户"===t.searchText?"用户":"关键字")+"，搜索"+t._s(t.searchText))]),t._v(" "),s("el-autocomplete",{attrs:{"fetch-suggestions":t.querySearchAsync,placeholder:"请输入..."},on:{select:t.handleSelect},model:{value:t.state,callback:function(e){t.state=e},expression:"state"}}),t._v(" "),s("p",{staticClass:"sort-desc"},[t._v("推荐"+t._s(t.searchText))]),t._v(" "),s("div",{staticClass:"selected-user"},t._l(t.recommendData,(function(e){return s("el-tag",{key:e.id,staticClass:"recommend-tag",attrs:{type:"info"},on:{click:function(s){return t.selectRecommend(e)}}},[t._v(t._s(e.name))])})),1),t._v(" "),s("el-button",{attrs:{type:"primary",size:"medium"},on:{click:t.backSortPage}},[t._v("返回")])],1)])},i=[function(){var t=this.$createElement,e=this._self._c||t;return e("p",{staticClass:"sort-switch-desc"},[this._v("说明："),e("br"),this._v("开启后，增加默认首页的标签，并按照如下规则显示默认首页数据：将勾选“添加内容”取并集，并且将“排除内容”在并集中去掉。")])}]},pESg:function(t,e,s){"use strict";s.r(e);var a=s("PCZf"),i=s("Fv4X");for(var r in i)["default"].indexOf(r)<0&&function(t){s.d(e,t,(function(){return i[t]}))}(r);var o=s("KHd+"),c=Object(o.a)(i.default,a.a,a.b,!1,null,null,null);e.default=c.exports}}]);