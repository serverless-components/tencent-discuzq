(window.webpackJsonp=window.webpackJsonp||[]).push([[62],{1038:function(e,t,r){},1171:function(e,t,r){e.exports=r.p+"img/wechat.7bcb838.png"},1172:function(e,t,r){"use strict";r(1038)},1262:function(e,t,r){"use strict";r.r(t);var head=r(716),o=r.n(head),n=r(715),c=r.n(n),h=r(158),l=r.n(h),d={name:"Wechat",mixins:[o.a,c.a,l.a],data:function(){return{title:this.$t("user.quicklogin"),code:"",wechatLogin:{},wechatLoginTimer:null,activeName:"0",ischeck:!0,preurl:"/"}},computed:{forums:function(){return this.$store.state.site.info.attributes||{}}},mounted:function(){var e=this.$route.query,code=e.code,t=e.preurl;t&&(this.preurl=t),"undefined"!==code&&(this.code=code),this.forums&&this.forums.set_site&&this.forums.set_site.site_mode&&(this.site_mode=this.forums.set_site.site_mode),this.createQRcode()},destroyed:function(){window.clearInterval(this.wechatLoginTimer)},methods:{check:function(e){this.ischeck=e},createQRcode:function(){var e=this;this.$store.dispatch("jv/get","/oauth/wechat/pc/qrcode").then((function(t){if(t){e.wechatLogin=t;var r=e;e.wechatLoginTimer=setInterval(r.getLoginStatus,3e3)}}),(function(t){return e.handleError(t)}))},getLoginStatus:function(){var e=this;this.wechatLogin&&!this.wechatLogin.session_token||this.$store.dispatch("jv/get","/oauth/wechat/pc/login/".concat(this.wechatLogin.session_token)).then((function(t){if(t){var r=t;r.data={data:{id:t._jv.id,attributes:{new_user:!!r.new_user}}},clearInterval(e.wechatLoginTimer),e.$store.commit("session/SET_USER_ID",t._jv.id),e.$store.commit("session/CHECK_SESSION",!0),e.$store.commit("session/SET_ACCESS_TOKEN",t.access_token),e.logind(r)}}),(function(t){var r=t.response.data.errors;if(Array.isArray(r)&&r.length>0){var o=r[0].detail&&r[0].detail.length>0?r[0].detail[0]:r[0].code,n=r[0].detail&&r[0].detail.length>0?r[0].detail[0]:e.$t("core.".concat(o));if("pc_qrcode_scanning_code"===o)return;if("no_bind_user"===o){var c=r[0].user.nickname,h=r[0].user.headimgurl,l=r[0].token;localStorage.setItem("wechat",l),e.forums&&e.forums.set_reg&&0===e.forums.set_reg.register_type&&e.$router.push("/user/register-bind?nickname=".concat(c,"&headimgurl=").concat(h)),e.forums&&e.forums.set_reg&&1===e.forums.set_reg.register_type&&e.$router.push("/user/wechat-bind-phone?nickname=".concat(c,"&headimgurl=").concat(h))}else clearInterval(e.wechatLoginTimer),e.$message.error(n),e.createQRcode()}}))},toUserlogin:function(){this.$router.push("/user/login?code=".concat(this.code,"&preurl=").concat(this.preurl))},toPhonelogin:function(){this.forums&&this.forums.set_reg&&1===this.forums.set_reg.register_type?this.$router.push("/user/phone-login-register?code=".concat(this.code,"&preurl=").concat(this.preurl)):this.$router.push("/user/phone-login?code=".concat(this.code,"&preurl=").concat(this.preurl))}}},m=(r(1172),r(11)),component=Object(m.a)(d,(function(){var e=this,t=e.$createElement,o=e._self._c||t;return e.forums?o("div",{staticClass:"register"},[e.forums&&e.forums.passport&&e.forums.passport.oplatform_close?o("div",[o("div",{staticClass:"register-header"},[e._v(e._s(e.forums&&e.forums.set_reg&&2!==e.forums.set_reg.register_type?e.$t("user.quicklogin"):e.$t("user.quicklogin")+"/注册")+"\n    ")]),e._v(" "),o("div",{staticClass:"register-content"},[o("div",{staticClass:"quick-container"},[o("div",{staticClass:"qrcode"},[o("img",{attrs:{src:e.wechatLogin.base64_img}})]),e._v(" "),o("div",{staticClass:"quick-title"},[o("img",{attrs:{src:r(1171)}}),e._v(" "),o("span",[e._v(e._s(e.forums&&e.forums.set_reg&&2!==e.forums.set_reg.register_type?e.$t("user.wechatlogin"):e.$t("user.wechatlogin")+"/注册")+"\n          ")])])]),e._v(" "),o("div",{staticClass:"agreement"},[e.forums&&e.forums.set_reg&&2===e.forums.set_reg.register_type?o("reg-agreement",{attrs:{check:!1},on:{check:e.check}}):e._e()],1),e._v(" "),o("div",{staticClass:"otherlogin"},[o("div",{staticClass:"otherlogin-title"}),e._v(" "),e.forums&&e.forums.qcloud&&e.forums.qcloud.qcloud_sms&&e.forums.set_reg&&2!==e.forums.set_reg.register_type?o("svg-icon",{staticClass:"phone-icon",attrs:{type:"phonelogin"},on:{click:e.toPhonelogin}}):e._e(),e._v(" "),o("svg-icon",{staticClass:"wechat-icon",attrs:{type:"userlogin"},on:{click:e.toUserlogin}})],1)])]):e._e()]):e._e()}),[],!1,null,"55d3fd22",null);t.default=component.exports;installComponents(component,{RegAgreement:r(902).default,SvgIcon:r(62).default})}}]);